{"version":3,"file":"fuzzify-pashto.es5.js","sources":["../src/fuzzify-pashto.ts"],"sourcesContent":["/**\n * Copyright (c) openpashto.com\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\ninterface FuzzifyOptions {\n  globalMatch?: boolean;\n  matchStart?: string;\n  matchWholeWordOnly?: boolean;\n  allowSpacesInWords?: boolean;\n  returnWholeWord?: boolean;\n  es2018?: boolean;\n  ignoreDiacritics?: boolean;\n}\n\n// Arabic punctuation to exclude\n// ، \\u060c ؟ \\u061f ؛ \\u061b ۔ \\u06d4\n// Digits etc. exclude \\u0660 - \\u066f\n\nconst pashtoCharacterRange = \"\\u0621-\\u065f\\u0670-\\u06d3\\u06d5\";\n// ISSUE: This does not work if the word is starting with a non-Pashto character like \" or « or .\n// I don't know how to solve this without lookbehinds in JavaScript (not available on all platforms)\nconst pashtoWordBoundaryBeginning = `(?:^|[^${pashtoCharacterRange}])`;\n// TODO: Better testing here - to see if this is really working in all cases\nconst pashtoWordBoundaryBeginningWithEs2018 = `(?<![${pashtoCharacterRange}])`;\nconst diacritics = \"\\u064b-\\u065f\\u0670\\u0674\"; // pretty generous diactritic range\n// TODO: Deal with diacritics etc.\n// .replace(/[\\u0600-\\u061e\\u064c-\\u0670\\u06D6-\\u06Ed]/g, '');\n// TODO: PROPER WORD BEGINNINGS!\n\n// TODO: add southern ش س (at beginning of word?)\n\nconst sSounds = \"صسثڅ\";\nconst zSounds = \"زضظذځژ\";\nconst tdSounds = \"طتټدډ\";\nconst velarPlosives = \"ګږکقگك\";\nconst rLikeSounds = \"رړڑڼ\";\nconst labialPlosivesAndFricatives = \"فپب\";\n// Includes Arabic ى \\u0649  \nconst theFiveYeys = \"ېۍیيئےى\";\n\nconst pashtoReplacer = {\n  \"اً\": { range: \"ان\" },\n  \"ا\": { range: \"اآهع\", plus: [\"اً\"] }, // TODO: make optional (if not at the beginning of word)\n  \"آ\": { range: \"اآه\" },\n  \"ٱ\": { range: \"اآه\" },\n  \"ٲ\": { range: \"اآه\" },\n  \"ٳ\": { range: \"اآه\" },\n\n  \"ی\": { range: theFiveYeys },\n  \"ي\": { range: theFiveYeys },\n  \"ې\": { range: theFiveYeys },\n  \"ۍ\": { range: theFiveYeys },\n  \"ئ\": { range: theFiveYeys },\n  \"ے\": { range: theFiveYeys },\n\n  \"س\": { range: sSounds }, \n  \"ص\": { range: sSounds },\n  \"ث\": { range: sSounds },\n  \"څ\": { range: sSounds + \"چ\" },\n\n  \"ج\": { range: \"چجڅځژ\" }, \n  \"چ\": { range: \"چجڅځ\" },\n  \n  \"ه\": { range: \"اهحہ\" },\n  \"ۀ\": { range: \"اهحہ\" },\n  \"ہ\": { range: \"اهحہ\" },\n\n  \"ع\": { range: \"اوع\", ignorable: true }, \n  \"و\": { range: \"وع\", ignorable: true }, \n  \"ؤ\": { range: \"وع\"},\n  \n  \"ښ\": { range: \"ښخشخهحغ\" },\n  \"غ\": { range: \"ښخشخهحغ\" },\n  \"خ\": { range: \"ښخشخهحغ\" },\n  \"ح\": { range: \"ښخشخهحغ\" },\n\n  \"ش\": { range: \"شښ\" },\n\n  \"ز\": { range: zSounds },\n  \"ض\": { range: zSounds },\n  \"ذ\": { range: zSounds },\n  \"ځ\": { range: zSounds + \"جڅ\"},\n  \"ظ\": { range: zSounds },\n\n  \"ژ\": { range: \"زضظژذځږج\" },\n\n  \"ر\": { range: rLikeSounds },\n  \"ړ\": { range: rLikeSounds },\n  \"ڑ\": { range: rLikeSounds },\n\n  \"ت\": { range: tdSounds },\n  \"ټ\": { range: tdSounds },\n  \"ٹ\": { range: tdSounds },\n  \"ط\": { range: tdSounds },\n  \"د\": { range: tdSounds },\n  \"ډ\": { range: tdSounds },\n  \"ڈ\": { range: tdSounds },\n\n  \"نب\": { range: \"نبم\" },\n  \"ن\": { range: \"نڼ\", plus: [\"اً\"] }, // allow for words using اٌ at the end te be seached for with ن\n  \"ڼ\": { range: \"نڼړڑ\" },\n\n  \"ک\": { range: velarPlosives },\n  \"ګ\": { range: velarPlosives },\n  \"گ\": { range: velarPlosives },\n  \"ق\": { range: velarPlosives },\n\n  \"ږ\": { range: velarPlosives + \"ژ\" },\n\n  \"ب\": { range: labialPlosivesAndFricatives },\n  \"پ\": { range: labialPlosivesAndFricatives },\n  \"ف\": { range: labialPlosivesAndFricatives },\n};\n\nconst thingsToReplace = Object.keys(pashtoReplacer);\nconst pashtoReplacerRegex = new RegExp(thingsToReplace.reduce((accumulator, currentValue, i) => {\n  if (i === thingsToReplace.length - 1) {\n    return accumulator + currentValue; \n  } \n  return accumulator + currentValue + \"|\";\n}, \"\"), \"g\");\n\nexport function es2018IsSupported(): boolean {\n  let supported = true;\n  try {\n    const a = new RegExp(\"(?<!a)b\");  \n  } catch(error) {\n    // Must ignore this line for testing, because not all environments can/will error here\n    /* istanbul ignore next */ \n    supported = false;\n  }\n  return supported;\n}\n\nexport function fuzzifyPashto(input: string, options: FuzzifyOptions = {}): RegExp {\n  let safeInput = input.trim().replace(/[#-.]|[[-^]|[?|{}]/g, \"\");\n  if (options.allowSpacesInWords) {\n    safeInput = safeInput.replace(/ /g, \"\");\n  }\n  if (options.ignoreDiacritics) {\n    safeInput = safeInput.replace(new RegExp(`[${diacritics}]`, \"g\"), \"\");\n  }\n  const regexLogic = safeInput.replace(pashtoReplacerRegex, (mtch) => {\n    const r = pashtoReplacer[mtch];\n    let range = `[${r.range}]`;\n    if (r.plus) {\n      const additionalOptionGroups = r.plus.reduce((t: string, o: string) => {\n        return t + o + \"|\";\n      }, \"\");\n      range = `(${additionalOptionGroups}${range})`;\n    }\n    return `${range}${r.ignorable ? \"?\" : \"\"}ع?${options.ignoreDiacritics ? `[${diacritics}]?`: \"\"}${options.allowSpacesInWords ? \"\\ ?\" : \"\"}`;\n  });\n  // Set how to begin the matching (default at the beginning of a word)\n  let beginning;\n  if (options.matchStart === \"string\") {\n    beginning = \"^\";\n  } else if (options.matchStart === \"anywhere\") {\n    beginning = \"\";\n  } else {\n    // \"word\" is the default\n    if (options.es2018) {\n      beginning = pashtoWordBoundaryBeginningWithEs2018;\n    } else {\n      beginning = pashtoWordBoundaryBeginning;\n    }\n  }\n  \n  let ending = \"\";\n  if (options.matchWholeWordOnly) {\n    if (options.matchStart === \"anywhere\") {\n      beginning = pashtoWordBoundaryBeginning;\n    }\n    ending = `(?![${pashtoCharacterRange}])`;\n  }\n  // If they're already using matchWholeWordOnly, don't change it\n  if (options.returnWholeWord && !options.matchWholeWordOnly) {\n    ending = `[${pashtoCharacterRange}]*(?![${pashtoCharacterRange}])`;\n    if (options.matchStart === \"anywhere\") {\n      beginning = `${pashtoWordBoundaryBeginning}[${pashtoCharacterRange}]*`; \n    }\n  }\n  const flags = `m${options.globalMatch === false ? \"\" : \"g\"}`;\n  return new RegExp(`${beginning}${regexLogic}${ending}`, flags);\n}\n  "],"names":[],"mappings":"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"}